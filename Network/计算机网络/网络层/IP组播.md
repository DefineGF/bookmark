#### IP组播（多播）

源计算机一次发送单个分组，抵达用一个组地址标识的若干目标主机

##### 条件

- UDP
- 组播地址 & IANA 之以太网组播地址；
- IGMP

##### 组播地址

IP组播 D类地址格式，每个D类IP地址标志一个组播组；

- 范围：224.0.0.0 ~ 239.255.255.255 但并非所有的D类地址均可作为组播地址
- 使用：仅作为目标地址；
- 注意：不产生 ICMP差错报文；
- 分类：因特网组播；硬件组播；（前者终究要交付给后者）

以太网组播地址：

01-00-5E-00-00-00 ~ 01-00-5E-7F-FF-FF；其中 7F：0111 1111 + 16b 故此有23b与D类地址一一对应；

比如 下面两个IP组播地址：

- 224.128.64.32 -> E0.80.40.20 (80: 1000 0000)
- 224.0.64.32     -> E0.00-40-20

相同以太网硬件组播地址，其IP组播地址并不一定相等；故需要在IP进一步过滤；



#### IGMP（Internet Group Management）

##### 第一阶段

​	某主机计入新组播组时，主机向组播地址发送一个IGMP报文；

​	组播路由器接到IGMP报文时候，将关系发送到其他组播路由器；

##### 第二阶段

​	本地组播路由器周期探询本地主机；

​	若无主机响应，则不再将该组的成员关系转发给其他组播路由器；



##### 组播路由选择

​	实际上是找出以源主机为根节点的组播转发树；

​	每个分组每个链路只转发一次；

​	同一多播组，不同源点会有不同转发路径；

算法：

- 基于链路状态的路由选择；
- 基于距离向量的路由选择；
- 协议无关的组播；



#### 处理过程

1. 网卡收到一个帧，交由设备驱动程序处理；若帧校验和侧护错则丢弃；
2.  判断帧类型，有IP，ARP等；若字段值 = 2，表名为 IGMP；
3. 多播过滤
    - 如果没有过滤，某主机收到不感兴趣的广播帧，需上传至IP，UDP方可被丢弃；
    - 通过第一个字节 01 判断是否是组播；