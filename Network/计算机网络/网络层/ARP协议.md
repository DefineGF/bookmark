#### ARP协议 （地址解析协议）

##### 帧格式

网络层协议；

直接使用以太网V2标准MAC帧封装ARP请求/应答分组；

ARP报文字段部分：

- 源MAC地址，目的MAC地址；
- 源IP地址，目的IP地址
- 操作字段：1 - 请求；2 - 应答



##### 功能

目的IP地址 -> ARP -> 目的MAC地址

##### 特点

- 并非主机或路由器具有MAC地址，而是他们的适配器（网络接口）具有链路层地址；

    故具有多个网络接口的主机/路由器具有多个MAC地址；

- 链路层交换机不具有MAC地址，只是作为主机和路由器之间承接数据报；

- ARP只为同一子网上的主机解析IP地址；

- 每台主机上都有ARP表（自建立，即插即用）：IP地址 -- MAC地址 -- TTL（过期时间）



##### 同一子网中解析IP地址

假设 222.222.222.221 要向 222.222.222.222 发送数据报；

1. ARP表中无此表项；
2. 构造ARP请求分组，MAC广播地址 FF-FF-FF-FF-FF-FF 作为目的硬件地址填入帧首部；
3. ARP查询的帧能被子网所有的适配器收到，如果ARP模块解析出的目的IP地址与自身匹配的话，发送回一个响应ARP分组（标准帧）；
4. 源主机和目的主机更新其ARP表；


##### 不同子网中解析IP地址

1. 封装请求ARP分组的目的MAC地址为至目的主机必经的路由器的MAC地址；

    （主机与此路由器位于同一网络，因此主机可以通过同一网络内ARP方法获取该路由器的MAC地址）

2. 帧到达路由器，路由器解析帧，得到目的IP地址；

3. 路由器经过同一网络ARP获得目的主机的MAC地址（保存在ARP表中），并将帧发送到目的主机（目的MAC地址为目的主机MAC地址）

4. 目的主机收到MAC地址时候，回复一个源MAC地址为请求主机要求的目的MAC地址；



